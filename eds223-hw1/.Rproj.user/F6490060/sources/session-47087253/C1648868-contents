---
title: "ej_screen"
format: html
---

```{r}
# Load packages
pacman::p_load('tidyverse', 'sf', 'here', 'tmap', 'tmaptools')
```

```{r}
# Load data with sf package
ejscreen <- sf::st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))
```

# Georgia
```{r}
# filter to georagia state
georgia <- ejscreen |> 
  filter(ST_ABBREV == "GA") 

# filter to Bacon, Georgia
bacon <- georgia |> 
  filter(CNTY_NAME %in% c("Bacon County"))

# find average values for all variables within counties
georgia_counties_means <- aggregate(georgia, by = list(georgia$CNTY_NAME), FUN = mean)
```

```{r}
# Define extent with st_bbox()
bbox_georgia <- st_bbox(c(xmin = -85.9, xmax = -80.5, ymax = 35.1, ymin = 30.4), crs = 4326)
```

```{r}
# Create first map
g_peopcolor <- tm_shape(georgia_counties_means, bbox = bbox_georgia) +
  tm_crs(4326) + # Specify crs
  tm_polygons(fill = "PEOPCOLORPCT",
              fill.scale = tm_scale(values = 'brewer.yl_or_rd'),
              fill.legend = tm_legend(title = "Percent People of Color", reverse = TRUE)) +
  tm_title(text = "Georgia Counties: Percent People of Color", fontface = 'bold', size = 4, padding = 0.1) +
  tm_layout(legend.position = c(0.65, 0.95)) # Adjust legend position
```

```{r}
# Save first map
tmap_save(tm = g_peopcolor, filename = "georgia_color.jpg")
```

```{r}
# Create second map
g_air_cancer <- tm_shape(georgia_counties_means, bbox = bbox_georgia) +
  tm_crs(4326) +
  tm_polygons(fill = "D2_RESP",
              fill.scale = tm_scale(values = 'brewer.yl_or_rd'),
              fill.legend = tm_legend(title = "Air Toxics Hazard Index", reverse = TRUE)) +
  tm_title(text = "Georgia Counties: Respiratory Hazard Index (EJ Index)",
           fontface = 'bold',
           size = 4,
           padding = 0.1) +
    tm_layout(legend.position = c(0.65, 0.95))
```

```{r}
# Save second map
tmap_save(tm = g_air_cancer, filename = "georgia_air.jpg")
```

