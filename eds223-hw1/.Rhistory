tm_grid() +
tm_layout(frame = FALSE) +
tm_view(bbox = c(xmin = -160, xmax = -156, ymin = 18, ymax = 23))
hawaii$Shape
# Chunk 1
# Load packages
pacman::p_load('tidyverse', 'sf', 'here', 'tmap', 'tmaptools')
# Chunk 2
# Load data with sf packages
ejscreen <- sf::st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))
# Chunk 3
# filter to a state you are interested in
hawaii <- ejscreen |>
filter(ST_ABBREV == "HI")
# filter to a county you are interested in
honolulu <- hawaii |>
filter(CNTY_NAME %in% c("Honolulu County"))
# find average values for all variables within counties
hawaii_counties_means <- aggregate(hawaii, by = list(hawaii$CNTY_NAME), FUN = mean)
# Chunk 4
# Try to filter out weird water boundary
# hawaii_filtered <- hawaii |>
#   select(-c("Shape_Length", "Shape_Area")) |>
#   filter(!if_all(where(is.numeric), ~ is.na(.) | . == 0))
#
# tm_shape(hawaii_filtered, bbox = bbox_main) +
#   tm_crs(4326) +
#   tm_polygons()
# Define bbox first and set crs
bbox_main <- st_bbox(c(xmin = -161, xmax = -154.4, ymax = 22.5, ymin = 18.8), crs = 4326)
# Create first map with new crs
tm_shape(hawaii_counties_means, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
tm_shape(hawaii_counties_means, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LIFEEXPPCT")
unique(ejscreen$STATE_NAME)
# filter to a state you are interested in
colorado <- ejscreen |>
filter(ST_ABBREV == "CO")
unique(colorado$CNTY_NAME)
# filter to a county you are interested in
boulder <- colorado |>
filter(CNTY_NAME %in% c("Boulder County"))
# find average values for all variables within counties
colorado_counties_means <- aggregate(colorado, by = list(colorado$CNTY_NAME), FUN = mean)
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -120, xmax = -90, ymax = 30, ymin = 45), crs = 4326)
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -110, xmax = -109, ymax = 30, ymin = 37), crs = 4326)
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -110, xmax = -101, ymax = 30, ymin = 37), crs = 4326)
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -110, xmax = -101, ymax = 37, ymin = 30), crs = 4326)
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -110, xmax = -101, ymax = 39, ymin = 36), crs = 4326)
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -110, xmax = -101, ymax = 41, ymin = 36), crs = 4326)
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -110, xmax = -101, ymax = 43, ymin = 36), crs = 4326)
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -109, xmax = -102, ymax = 41, ymin = 37), crs = 4326)
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "PTRAF")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LOWINPCT")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LOWINCPCT")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LIFEEXPPCT")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "CANCER")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "PTSDF")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LOWINCPCT")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "PTSDF")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "PRE1960PCT")
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "CANCER")
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# filter to a state you are interested in
newyork <- ejscreen |>
filter(ST_ABBREV == "NY")
unique(newyork$CNTY_NAME)
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -74, xmax = -75, ymax = 41, ymin = 37), crs = 4326)
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -74, xmax = -75, ymax = 41, ymin = 37), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# find average values for all variables within counties
newyork_counties_means <- aggregate(newyork, by = list(newyork$CNTY_NAME), FUN = mean)
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -74, xmax = -75, ymax = 41, ymin = 37), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -74, xmax = -73, ymax = 41, ymin = 37), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -74, xmax = -71, ymax = 41, ymin = 37), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -74, xmax = -71, ymax = 44, ymin = 40), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -79, xmax = -71, ymax = 44, ymin = 40), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -81, xmax = -71, ymax = 44, ymin = 40), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -81, xmax = -71, ymax = 45, ymin = 40), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -81, xmax = -71, ymax = 46, ymin = 40), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -81, xmax = -71, ymax = 45.2, ymin = 40.2), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main3 <- st_bbox(c(xmin = -80, xmax = -71.5, ymax = 45.2, ymin = 40.2), crs = 4326)
# Create first map with new crs
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LOWINPCT")
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LOWINCPCT")
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "PNPL")
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "CANCER")
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LIFEEXPPCT")
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "LESSHSPCT")
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "UNEMPPCT")
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "PTRAF")
tm_shape(niagra, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "PTRAF")
# filter to a county you are interested in
niagra <- newyork |>
filter(CNTY_NAME %in% c("Niagra County"))
tm_shape(newyork_counties_means, bbox = bbox_main3) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "PTRAF")
# filter to a state you are interested in
hawaii <- ejscreen |>
filter(ST_ABBREV == "HI")
# filter to a county you are interested in
honolulu <- hawaii |>
filter(CNTY_NAME %in% c("Honolulu County"))
# find average values for all variables within counties
hawaii_counties_means <- aggregate(hawaii, by = list(hawaii$CNTY_NAME), FUN = mean)
hawaii$Shape
# Define bbox first and set crs
bbox_main <- st_bbox(c(xmin = -161, xmax = -154.4, ymax = 22.5, ymin = 18.8), crs = 4326)
# Create first map with new crs
tm_shape(hawaii_counties_means, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Define bbox first and set crs
bbox_main <- st_bbox(c(xmin = -161, xmax = -154.4, ymax = 22.5, ymin = 18.8), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Create first map with new crs
tm_shape(hawaii_counties_means, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
bbox_main <- st_bbox(c(xmin = -159, xmax = -158.5, ymax = 21.5, ymin = 21), crs = 4326)
bbox_main <- st_bbox(c(xmin = -159, xmax = -158.5, ymax = 21.5, ymin = 21), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
bbox_main <- st_bbox(c(xmin = -159, xmax = -158, ymax = 21.5, ymin = 21), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
bbox_main <- st_bbox(c(xmin = -158.5, xmax = -157, ymax = 21.5, ymin = 21), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
bbox_main <- st_bbox(c(xmin = -158.5, xmax = -157.6, ymax = 21.5, ymin = 21), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
bbox_main <- st_bbox(c(xmin = -158.5, xmax = -157.6, ymax = 22, ymin = 21.2), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
bbox_main <- st_bbox(c(xmin = -158.5, xmax = -157.6, ymax = 21.8, ymin = 21.2), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
bbox_main <- st_bbox(c(xmin = -158.3, xmax = -157.6, ymax = 21.8, ymin = 21.2), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
bbox_main <- st_bbox(c(xmin = -158.3, xmax = -157.6, ymax = 21.8, ymin = 21.2), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP", lty = 'blank')
# find average values for all variables within counties
hawaii_counties_means <- aggregate(hawaii, by = list(hawaii$CNTY_NAME), FUN = mean)
bbox_main <- st_bbox(c(xmin = -158.3, xmax = -157.6, ymax = 21.8, ymin = 21.2), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "ACSTOTPOP", lty = 'blank')
oahu_filtered <- honolulu |>
mutate(area = st_area(geometry)) |>
filter(area < max(area))  # drop the single largest polygon
oahu_filtered <- honolulu |>
mutate(area = st_area(Shape)) |>
filter(area < max(area))  # drop the single largest polygon
View(oahu_filtered)
# Create first map with new crs
tm_shape(oahu_filtered, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "ACSTOTPOP", lty = 'blank')
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "ACSTOTPOP", lty = 'blank')
oahu_filtered <- honolulu |>
filter(Shape_Area < max(Shape_Area))  # drop the single largest polygon
# Create first map with new crs
tm_shape(oahu_filtered, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(lty = 'blank')
hawaii_colored <- hawaii |>
mutate(
polygon_id = row_number()
)
honolulu_colored <- honolulu |>
mutate(
polygon_id = row_number()
)
tm_shape(honolulu_colored) +
tm_polygons(col = "Shape_Area", style = "quantile", title = "Area") +
tm_text("polygon_id", size = 0.6)
tm_shape(honolulu_colored, bbox = bbox_main) +
tm_polygons(col = "Shape_Area", style = "quantile", title = "Area") +
tm_text("polygon_id", size = 0.6)
names(honolulu)
View(oahu_filtered)
honolulu_lastrow <- honolulu[-nrow(honolulu), ]
View(honolulu_lastrow)
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(lty = 'blank')
class(honolulu)
bbox_main <- st_bbox(c(xmin = -158.3, xmax = -157.6, ymax = 21.8, ymin = 21.2), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(lty = 'blank')
# Fucking finally, use this fuckass dataframe
honolulu_lastrow <- honolulu[-nrow(honolulu), ]
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "ACSTOTPOP", lty = 'blank')
bbox_main <- st_bbox(c(xmin = -158.3, xmax = -157.75, ymax = 21.7, ymin = 21.27), crs = 4326)
# Create first map with new crs
tm_shape(honolulu, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(lty = 'blank')
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "ACSTOTPOP", lty = 'blank')
bbox_main <- st_bbox(c(xmin = -158.3, xmax = -157.72, ymax = 21.7, ymin = 21.27), crs = 4326)
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "ACSTOTPOP", lty = 'blank')
bbox_main <- st_bbox(c(xmin = -158.3, xmax = -157.7, ymax = 21.7, ymin = 21.27), crs = 4326)
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "ACSTOTPOP", lty = 'blank')
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "LOWINCPCT", lty = 'blank')
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "LOWINCOME", lty = 'blank')
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "PWDIS", lty = 'blank')
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "P_D2_PWDIS", lty = 'blank')
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "P_LOWINCPCT", lty = 'blank')
tm_shape(honolulu_lastrow, bbox = bbox_main) +
tm_crs(4326) +
tm_grid() +
tm_borders() +
tm_polygons(fill = "P_D2_PTSDF", lty = 'blank')
# Define bbox first and set crs
bbox_main2 <- st_bbox(c(xmin = -109, xmax = -102, ymax = 41, ymin = 37), crs = 4326)
# Create first map with new crs
tm_shape(boulder, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Create first map with new crs
tm_shape(colorado_counties_means, bbox = bbox_main2) +
tm_crs(4326) +
tm_grid() +
tm_polygons(fill = "ACSTOTPOP")
# Load packages
pacman::p_load('tidyverse', 'sf', 'here', 'tmap', 'tmaptools')
# Load data with sf packages
ejscreen <- sf::st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))
# filter to a state you are interested in
hawaii <- ejscreen |>
filter(ST_ABBREV == "HI")
# filter to a county you are interested in
honolulu <- hawaii |>
filter(CNTY_NAME %in% c("Honolulu County"))
# find average values for all variables within counties
hawaii_counties_means <- aggregate(hawaii, by = list(hawaii$CNTY_NAME), FUN = mean)
